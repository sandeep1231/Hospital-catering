{"ast":null,"code":"import { ApiService } from '../../services/api.service';\nimport { ToastService } from '../../services/toast.service';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/toast.service\";\nimport * as i3 from \"@angular/router\";\nfunction ManualOrderComponent_tr_35_option_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", p_r5._id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(p_r5.name);\n  }\n}\nfunction ManualOrderComponent_tr_35_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", m_r6._id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(m_r6.name);\n  }\n}\nfunction ManualOrderComponent_tr_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"select\", 24);\n    i0.ɵɵlistener(\"ngModelChange\", function ManualOrderComponent_tr_35_Template_select_ngModelChange_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const it_r1 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(it_r1.patientId = $event);\n    });\n    i0.ɵɵelementStart(3, \"option\", 25);\n    i0.ɵɵtext(4, \"-- select patient --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, ManualOrderComponent_tr_35_option_5_Template, 2, 2, \"option\", 26);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"td\")(7, \"select\", 24);\n    i0.ɵɵlistener(\"ngModelChange\", function ManualOrderComponent_tr_35_Template_select_ngModelChange_7_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const it_r1 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(it_r1.menuItemId = $event);\n    });\n    i0.ɵɵelementStart(8, \"option\", 25);\n    i0.ɵɵtext(9, \"-- select menu --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, ManualOrderComponent_tr_35_option_10_Template, 2, 2, \"option\", 26);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"td\")(12, \"input\", 27);\n    i0.ɵɵlistener(\"ngModelChange\", function ManualOrderComponent_tr_35_Template_input_ngModelChange_12_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const it_r1 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(it_r1.quantity = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"td\")(14, \"input\", 28);\n    i0.ɵɵlistener(\"ngModelChange\", function ManualOrderComponent_tr_35_Template_input_ngModelChange_14_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const it_r1 = restoredCtx.$implicit;\n      return i0.ɵɵresetView(it_r1.notes = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"button\", 29);\n    i0.ɵɵlistener(\"click\", function ManualOrderComponent_tr_35_Template_button_click_16_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const i_r2 = restoredCtx.index;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.removeItem(i_r2));\n    });\n    i0.ɵɵtext(17, \"Remove\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const it_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"name\", \"p\", i_r2, \"\");\n    i0.ɵɵproperty(\"ngModel\", it_r1.patientId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngValue\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.patients);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"name\", \"m\", i_r2, \"\");\n    i0.ɵɵproperty(\"ngModel\", it_r1.menuItemId);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngValue\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.menu);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"name\", \"q\", i_r2, \"\");\n    i0.ɵɵproperty(\"ngModel\", it_r1.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"name\", \"n\", i_r2, \"\");\n    i0.ɵɵproperty(\"ngModel\", it_r1.notes);\n  }\n}\nexport let ManualOrderComponent = /*#__PURE__*/(() => {\n  class ManualOrderComponent {\n    constructor(api, toast, router) {\n      this.api = api;\n      this.toast = toast;\n      this.router = router;\n      this.date = new Date().toISOString().substring(0, 10);\n      this.items = [];\n      this.patients = [];\n      this.menu = [];\n    }\n    ngOnInit() {\n      this.api.get('/patients').subscribe(res => this.patients = res || []);\n      this.api.get('/menu').subscribe(res => this.menu = res || []);\n      this.addItem();\n    }\n    addItem() {\n      this.items.push({\n        patientId: '',\n        menuItemId: '',\n        quantity: 1,\n        notes: ''\n      });\n    }\n    removeItem(i) {\n      this.items.splice(i, 1);\n    }\n    save(e) {\n      e.preventDefault();\n      const payload = {\n        date: this.date,\n        items: this.items.filter(it => it.patientId && it.menuItemId && it.quantity > 0)\n      };\n      if (payload.items.length === 0) {\n        this.toast.error('Add at least one item');\n        return;\n      }\n      this.api.post('/orders', payload).subscribe(res => {\n        this.toast.success('Order created');\n        this.router.navigate(['/orders']);\n      }, err => {\n        this.toast.error(err?.error?.message || 'Failed');\n        console.error(err);\n      });\n    }\n    static {\n      this.ɵfac = function ManualOrderComponent_Factory(t) {\n        return new (t || ManualOrderComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.ToastService), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ManualOrderComponent,\n        selectors: [[\"app-manual-order\"]],\n        decls: 39,\n        vars: 2,\n        consts: [[1, \"container\"], [1, \"d-flex\", \"align-items-center\", \"mb-3\"], [1, \"me-auto\", \"mb-0\"], [\"routerLink\", \"/orders\", 1, \"btn\", \"btn-outline-secondary\"], [3, \"submit\"], [1, \"card\", \"mb-3\"], [1, \"card-body\"], [1, \"row\", \"g-3\", \"align-items-end\"], [1, \"col-12\", \"col-md-3\"], [1, \"form-label\"], [\"type\", \"date\", \"name\", \"date\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"card\"], [1, \"d-flex\", \"align-items-center\", \"mb-2\"], [1, \"mb-0\", \"me-auto\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-primary\", 3, \"click\"], [1, \"table-responsive\"], [1, \"table\", \"align-middle\"], [2, \"width\", \"30%\"], [2, \"width\", \"40%\"], [2, \"width\", \"10%\"], [2, \"width\", \"80px\"], [4, \"ngFor\", \"ngForOf\"], [1, \"text-end\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [1, \"form-select\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [3, \"ngValue\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"min\", \"1\", 1, \"form-control\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [1, \"form-control\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [3, \"value\"]],\n        template: function ManualOrderComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h4\", 2);\n            i0.ɵɵtext(3, \"Create Order\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"a\", 3);\n            i0.ɵɵtext(5, \"Back to Orders\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"form\", 4);\n            i0.ɵɵlistener(\"submit\", function ManualOrderComponent_Template_form_submit_6_listener($event) {\n              return ctx.save($event);\n            });\n            i0.ɵɵelementStart(7, \"div\", 5)(8, \"div\", 6)(9, \"div\", 7)(10, \"div\", 8)(11, \"label\", 9);\n            i0.ɵɵtext(12, \"Date\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"input\", 10);\n            i0.ɵɵlistener(\"ngModelChange\", function ManualOrderComponent_Template_input_ngModelChange_13_listener($event) {\n              return ctx.date = $event;\n            });\n            i0.ɵɵelementEnd()()()()();\n            i0.ɵɵelementStart(14, \"div\", 11)(15, \"div\", 6)(16, \"div\", 12)(17, \"h5\", 13);\n            i0.ɵɵtext(18, \"Items\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"button\", 14);\n            i0.ɵɵlistener(\"click\", function ManualOrderComponent_Template_button_click_19_listener() {\n              return ctx.addItem();\n            });\n            i0.ɵɵtext(20, \"Add item\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 15)(22, \"table\", 16)(23, \"thead\")(24, \"tr\")(25, \"th\", 17);\n            i0.ɵɵtext(26, \"Patient\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(27, \"th\", 18);\n            i0.ɵɵtext(28, \"Menu Item\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"th\", 19);\n            i0.ɵɵtext(30, \"Qty\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(31, \"th\");\n            i0.ɵɵtext(32, \"Notes\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(33, \"th\", 20);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(34, \"tbody\");\n            i0.ɵɵtemplate(35, ManualOrderComponent_tr_35_Template, 18, 12, \"tr\", 21);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(36, \"div\", 22)(37, \"button\", 23);\n            i0.ɵɵtext(38, \"Create Order\");\n            i0.ɵɵelementEnd()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(13);\n            i0.ɵɵproperty(\"ngModel\", ctx.date);\n            i0.ɵɵadvance(22);\n            i0.ɵɵproperty(\"ngForOf\", ctx.items);\n          }\n        },\n        styles: [\".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle}\"]\n      });\n    }\n  }\n  return ManualOrderComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}