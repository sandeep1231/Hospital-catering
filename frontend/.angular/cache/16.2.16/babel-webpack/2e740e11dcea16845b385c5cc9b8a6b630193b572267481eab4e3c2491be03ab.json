{"ast":null,"code":"import { ApiService } from '../../services/api.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction DietSupervisorComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DietSupervisorComponent_div_38_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"No assignments for today\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DietSupervisorComponent_div_38_div_2_tr_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"td\")(17, \"div\", 37)(18, \"div\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"button\", 38);\n    i0.ɵɵlistener(\"click\", function DietSupervisorComponent_div_38_div_2_tr_21_Template_button_click_20_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const a_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r6.markDelivered(a_r5));\n    });\n    i0.ɵɵtext(21, \"Deliver\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const a_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(3, 9, a_r5.date, \"dd-MM-yyyy\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(a_r5.patientName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r5.phone || \"\\u2014\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((a_r5.roomType || \"\\u2014\") + \" / \" + (a_r5.roomNo || \"\\u2014\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r5.bed || \"\\u2014\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r5.diet);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(a_r5.note);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(a_r5.status);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", a_r5.status !== \"pending\");\n  }\n}\nfunction DietSupervisorComponent_div_38_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"table\", 27)(2, \"thead\")(3, \"tr\")(4, \"th\", 28);\n    i0.ɵɵtext(5, \"Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\", 29);\n    i0.ɵɵtext(7, \"Patient\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\", 30);\n    i0.ɵɵtext(9, \"Mobile\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\", 31);\n    i0.ɵɵtext(11, \"Room\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\", 32);\n    i0.ɵɵtext(13, \"Bed\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\", 33);\n    i0.ɵɵtext(15, \"Diet\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"th\", 34);\n    i0.ɵɵtext(17, \"Note\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"th\", 35);\n    i0.ɵɵtext(19, \"Status\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(20, \"tbody\");\n    i0.ɵɵtemplate(21, DietSupervisorComponent_div_38_div_2_tr_21_Template, 22, 12, \"tr\", 36);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(21);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.assignments);\n  }\n}\nfunction DietSupervisorComponent_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, DietSupervisorComponent_div_38_div_1_Template, 2, 0, \"div\", 23);\n    i0.ɵɵtemplate(2, DietSupervisorComponent_div_38_div_2_Template, 22, 1, \"div\", 24);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.assignments.length === 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.assignments.length);\n  }\n}\nexport let DietSupervisorComponent = /*#__PURE__*/(() => {\n  class DietSupervisorComponent {\n    constructor(api) {\n      this.api = api;\n      this.assignments = [];\n      this.loading = false;\n      // filters\n      this.date = new Date().toISOString().slice(0, 10);\n      this.roomType = '';\n      this.roomNo = '';\n      this.q = '';\n      this.delivering = {};\n      this.view = [];\n    }\n    ngOnInit() {\n      this.load();\n    }\n    load() {\n      this.loading = true;\n      const params = {\n        date: this.date\n      };\n      if (this.roomType) params.roomType = this.roomType;\n      if (this.roomNo) params.roomNo = this.roomNo;\n      this.api.get('/reports/diet-supervisor/today', params).subscribe(res => {\n        this.assignments = res;\n        this.applyQuickFilter();\n        this.loading = false;\n      }, err => {\n        console.error(err);\n        this.loading = false;\n      });\n    }\n    markDelivered(a) {\n      if (!confirm('Mark this assignment as delivered?')) return;\n      const id = a._id || a.id; // reports provide id\n      if (!id) {\n        alert('Missing assignment id');\n        return;\n      }\n      this.delivering[id] = true;\n      this.api.post(`/diet-assignments/${id}/deliver`, {}).subscribe(res => {\n        this.delivering[id] = false;\n        this.load();\n      }, err => {\n        console.error(err);\n        alert('Failed to mark delivered');\n        this.delivering[id] = false;\n      });\n    }\n    applyQuickFilter() {\n      const term = (this.q || '').toLowerCase().trim();\n      if (!term) {\n        this.view = this.assignments.slice();\n        return;\n      }\n      this.view = this.assignments.filter(a => {\n        const name = String(a.patientName || '').toLowerCase();\n        const phone = String(a.phone || '').toLowerCase();\n        return name.includes(term) || phone.includes(term);\n      });\n    }\n    generateToday() {\n      if (!confirm(\"Generate today's assignments for all in-patients with a diet?\")) return;\n      this.loading = true;\n      this.api.post('/diet-assignments/generate-today', {}).subscribe(res => {\n        this.load();\n      }, err => {\n        console.error(err);\n        alert('Failed to generate');\n        this.loading = false;\n      });\n    }\n    static {\n      this.ɵfac = function DietSupervisorComponent_Factory(t) {\n        return new (t || DietSupervisorComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DietSupervisorComponent,\n        selectors: [[\"app-diet-supervisor\"]],\n        decls: 39,\n        vars: 8,\n        consts: [[1, \"container\", \"mt-3\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\", \"mb-3\"], [1, \"mb-0\"], [1, \"d-flex\", \"gap-2\"], [1, \"btn\", \"btn-sm\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"btn\", \"btn-sm\", \"btn-secondary\", 3, \"disabled\", \"click\"], [1, \"card\", \"mb-3\"], [1, \"card-body\"], [1, \"row\", \"g-2\", \"align-items-end\"], [1, \"col-6\", \"col-md-3\"], [1, \"form-label\"], [\"type\", \"date\", \"name\", \"filterDate\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"filterRoomType\", 1, \"form-select\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"\"], [\"value\", \"Ward\"], [\"value\", \"ICU\"], [\"value\", \"Cabin\"], [\"value\", \"Other\"], [\"name\", \"filterRoomNo\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"col-6\", \"col-md-3\", \"text-end\"], [\"class\", \"text-center py-4\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"text-center\", \"py-4\"], [\"class\", \"alert alert-light\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"alert\", \"alert-light\"], [1, \"table-responsive\"], [1, \"table\", \"table-sm\", \"align-middle\"], [1, \"w-date\"], [1, \"w-patient\"], [1, \"w-mobile\"], [1, \"w-room\"], [1, \"w-bed\"], [1, \"w-diet\"], [1, \"w-note\"], [1, \"w-status\"], [4, \"ngFor\", \"ngForOf\"], [1, \"d-flex\", \"align-items-center\", 2, \"gap\", \".25rem\"], [1, \"btn\", \"btn-sm\", \"btn-outline-success\", 3, \"disabled\", \"click\"]],\n        template: function DietSupervisorComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h4\", 2);\n            i0.ɵɵtext(3, \"Diet Supervisor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 3)(5, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function DietSupervisorComponent_Template_button_click_5_listener() {\n              return ctx.generateToday();\n            });\n            i0.ɵɵtext(6, \"Generate today's list\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function DietSupervisorComponent_Template_button_click_7_listener() {\n              return ctx.load();\n            });\n            i0.ɵɵtext(8, \"Refresh\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(9, \"div\", 6)(10, \"div\", 7)(11, \"div\", 8)(12, \"div\", 9)(13, \"label\", 10);\n            i0.ɵɵtext(14, \"Date\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"input\", 11);\n            i0.ɵɵlistener(\"ngModelChange\", function DietSupervisorComponent_Template_input_ngModelChange_15_listener($event) {\n              return ctx.date = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(16, \"div\", 9)(17, \"label\", 10);\n            i0.ɵɵtext(18, \"Room Type\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"select\", 12);\n            i0.ɵɵlistener(\"ngModelChange\", function DietSupervisorComponent_Template_select_ngModelChange_19_listener($event) {\n              return ctx.roomType = $event;\n            });\n            i0.ɵɵelementStart(20, \"option\", 13);\n            i0.ɵɵtext(21, \"All\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"option\", 14);\n            i0.ɵɵtext(23, \"Ward\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"option\", 15);\n            i0.ɵɵtext(25, \"ICU\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"option\", 16);\n            i0.ɵɵtext(27, \"Cabin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"option\", 17);\n            i0.ɵɵtext(29, \"Other\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(30, \"div\", 9)(31, \"label\", 10);\n            i0.ɵɵtext(32, \"Room No\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"input\", 18);\n            i0.ɵɵlistener(\"ngModelChange\", function DietSupervisorComponent_Template_input_ngModelChange_33_listener($event) {\n              return ctx.roomNo = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(34, \"div\", 19)(35, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function DietSupervisorComponent_Template_button_click_35_listener() {\n              return ctx.load();\n            });\n            i0.ɵɵtext(36, \"Apply\");\n            i0.ɵɵelementEnd()()()()();\n            i0.ɵɵtemplate(37, DietSupervisorComponent_div_37_Template, 2, 0, \"div\", 20);\n            i0.ɵɵtemplate(38, DietSupervisorComponent_div_38_Template, 3, 2, \"div\", 21);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngModel\", ctx.date);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngModel\", ctx.roomType);\n            i0.ɵɵadvance(14);\n            i0.ɵɵproperty(\"ngModel\", ctx.roomNo);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i2.NgForOf, i2.NgIf, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgModel, i2.DatePipe],\n        styles: [\".w-date[_ngcontent-%COMP%]{width:110px}.w-patient[_ngcontent-%COMP%]{width:180px}.w-mobile[_ngcontent-%COMP%]{width:130px}.w-room[_ngcontent-%COMP%]{width:120px}.w-bed[_ngcontent-%COMP%]{width:70px}.w-diet[_ngcontent-%COMP%]{width:140px}.w-note[_ngcontent-%COMP%]{width:200px}.w-status[_ngcontent-%COMP%]{width:160px}table.table[_ngcontent-%COMP%]   th.w-date[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){min-width:110px}table.table[_ngcontent-%COMP%]   th.w-patient[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2){min-width:180px}table.table[_ngcontent-%COMP%]   th.w-mobile[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(3){min-width:130px}table.table[_ngcontent-%COMP%]   th.w-room[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){min-width:120px}table.table[_ngcontent-%COMP%]   th.w-bed[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(5){min-width:70px}table.table[_ngcontent-%COMP%]   th.w-diet[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6){min-width:140px}table.table[_ngcontent-%COMP%]   th.w-note[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7){min-width:200px}table.table[_ngcontent-%COMP%]   th.w-status[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8){min-width:160px}table.table[_ngcontent-%COMP%]   th.w-status[_ngcontent-%COMP%], table.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8){white-space:nowrap}\"]\n      });\n    }\n  }\n  return DietSupervisorComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}