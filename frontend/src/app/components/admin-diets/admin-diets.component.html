<div class="container mt-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Manage Diets</h4>
    <div>
      <button class="btn btn-sm btn-primary me-2" (click)="newDiet()">New Diet</button>
      <button class="btn btn-sm btn-secondary" (click)="load()">Refresh</button>
    </div>
  </div>

  <!-- Near-zero shift: in-place skeletons within table/cards -->

  <div *ngIf="!loading">
    <!-- Desktop/tablet large and up: tabular view -->
    <div class="d-none d-lg-block">
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th style="width:40%">Diet</th>
              <th style="width:20%">Default Price</th>
              <th style="width:20%">Status</th>
              <th class="text-end" style="width:20%">Actions</th>
            </tr>
          </thead>
          <tbody [class.placeholder-glow]="loading">
            <!-- Skeleton rows while loading -->
            <ng-container *ngIf="loading; else dietRows">
              <tr *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
                <td><span class="placeholder col-8"></span></td>
                <td><span class="placeholder col-6"></span></td>
                <td><span class="placeholder col-5"></span></td>
                <td class="text-end"><span class="placeholder col-6"></span></td>
              </tr>
            </ng-container>
            <!-- Real rows -->
            <ng-template #dietRows>
            <tr *ngFor="let d of diets">
              <td class="fw-semibold">{{d.name}}</td>
              <td>{{d.defaultPrice}}</td>
              <td>
                <span class="badge" [class.bg-success]="d.active" [class.bg-secondary]="!d.active">{{ d.active ? 'Active' : 'Inactive' }}</span>
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-secondary me-1" (click)="edit(d)">Edit</button>
                <button class="btn btn-sm btn-outline-danger" (click)="remove(d)">Delete</button>
              </td>
            </tr>
            </ng-template>
            <tr *ngIf="diets?.length===0">
              <td colspan="4" class="text-center text-muted">No diets found</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Mobile/tablet small/medium: card view -->
    <div class="d-lg-none">
      <div class="row g-2">
        <!-- Skeleton cards while loading -->
        <ng-container *ngIf="loading; else dietCards">
          <div class="col-12" *ngFor="let i of [1,2,3,4,5]">
            <div class="card">
              <div class="card-body placeholder-glow d-flex justify-content-between align-items-center">
                <div class="w-75">
                  <div class="placeholder col-8 mb-2"></div>
                  <div class="placeholder col-6 mb-1"></div>
                  <div class="placeholder col-4"></div>
                </div>
                <div class="w-25 text-end">
                  <div class="placeholder col-6 mb-2"></div>
                  <div class="placeholder col-6"></div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
        <!-- Real cards -->
        <ng-template #dietCards>
        <div class="col-12" *ngFor="let d of diets">
          <div class="card">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">{{d.name}}</div>
                <div class="small text-muted">Default Price: {{d.defaultPrice}}</div>
                <div class="small" [class.text-success]="d.active" [class.text-muted]="!d.active">{{ d.active ? 'Active' : 'Inactive' }}</div>
              </div>
              <div class="text-end">
                <button class="btn btn-sm btn-outline-secondary me-1" (click)="edit(d)">Edit</button>
                <button class="btn btn-sm btn-outline-danger" (click)="remove(d)">Delete</button>
              </div>
            </div>
          </div>
        </div>
        </ng-template>
        <div class="col-12" *ngIf="diets?.length===0">
          <div class="text-center text-muted py-3">No diets found</div>
        </div>
      </div>
    </div>

    <div *ngIf="editing" class="card mt-3 p-3">
      <h6>{{editing._id ? 'Edit' : 'New'}} Diet</h6>
      <div class="row g-2">
        <div class="col-6"><input class="form-control" [(ngModel)]="editing.name" placeholder="Name" /></div>
        <div class="col-3"><input class="form-control" type="number" [(ngModel)]="editing.defaultPrice" placeholder="Default price" /></div>
        <div class="col-2"><select class="form-select" [(ngModel)]="editing.active"><option [ngValue]="true">Active</option><option [ngValue]="false">Inactive</option></select></div>
        <div class="col-12 text-end mt-2">
          <button class="btn btn-sm btn-secondary me-2" (click)="cancel()">Cancel</button>
          <button class="btn btn-sm btn-primary" (click)="save()">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>
