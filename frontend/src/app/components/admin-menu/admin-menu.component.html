<div class="d-flex mb-3 align-items-center">
  <h4 class="me-auto">Menu Items</h4>
  <button class="btn btn-sm btn-outline-primary" (click)="startCreate()" *ngIf="!creating">+ New Item</button>
</div>

<div class="card mb-3" *ngIf="creating">
  <div class="card-body">
    <h5 class="mb-3">Create Menu Item</h5>
    <div class="row g-2">
      <div class="col-md-4">
        <label class="form-label">Name</label>
        <input class="form-control" [(ngModel)]="newItem.name" name="c_name" />
      </div>
      <div class="col-md-2">
        <label class="form-label">Price</label>
        <input class="form-control" type="number" min="0" step="0.01" [(ngModel)]="newItem.price" name="c_price" />
      </div>
      <div class="col-md-2">
        <label class="form-label">Calories</label>
        <input class="form-control" type="number" min="0" [(ngModel)]="newItem.calories" name="c_cal" />
      </div>
      <div class="col-12">
        <label class="form-label">Description</label>
        <input class="form-control" [(ngModel)]="newItem.description" name="c_desc" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Diet Tags (comma separated)</label>
        <input class="form-control" [(ngModel)]="newItem.dietTags" name="c_tags" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Allergens (comma separated)</label>
        <input class="form-control" [(ngModel)]="newItem.allergens" name="c_all" />
      </div>
    </div>
    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-primary" (click)="saveCreate()">Create</button>
      <button class="btn btn-outline-secondary" (click)="cancelCreate()">Cancel</button>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="d-flex mb-3">
      <input class="form-control" placeholder="Search menu" [(ngModel)]="q" />
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Calories</th>
            <th>Tags</th>
            <th>Allergens</th>
            <th style="width: 180px"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let it of filtered()">
            <td *ngIf="editingId !== it._id">{{it.name}}</td>
            <td *ngIf="editingId === it._id"><input class="form-control" [(ngModel)]="editItem.name" name="e_name{{it._id}}" /></td>

            <td *ngIf="editingId !== it._id">{{it.price | currency}}</td>
            <td *ngIf="editingId === it._id"><input class="form-control" type="number" step="0.01" [(ngModel)]="editItem.price" name="e_price{{it._id}}" /></td>

            <td *ngIf="editingId !== it._id">{{it.calories}}</td>
            <td *ngIf="editingId === it._id"><input class="form-control" type="number" [(ngModel)]="editItem.calories" name="e_cal{{it._id}}" /></td>

            <td *ngIf="editingId !== it._id">{{(it.dietTags||[]).join(', ')}}</td>
            <td *ngIf="editingId === it._id"><input class="form-control" [(ngModel)]="editItem.dietTags" name="e_tags{{it._id}}" /></td>

            <td *ngIf="editingId !== it._id">{{(it.allergens||[]).join(', ')}}</td>
            <td *ngIf="editingId === it._id"><input class="form-control" [(ngModel)]="editItem.allergens" name="e_all{{it._id}}" /></td>

            <td class="text-end">
              <ng-container *ngIf="editingId !== it._id; else editBtns">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="startEdit(it)">Edit</button>
                <button class="btn btn-sm btn-outline-danger" (click)="remove(it)">Delete</button>
              </ng-container>
              <ng-template #editBtns>
                <button class="btn btn-sm btn-primary me-2" (click)="saveEdit()">Save</button>
                <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">Cancel</button>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
